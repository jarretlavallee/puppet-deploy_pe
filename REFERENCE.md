# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Functions**

* [`deploy_pe::master_package_name`](#deploy_pemaster_package_name): Generate the PE installer package name
* [`deploy_pe::platform_tag`](#deploy_peplatform_tag): Generate the PE naming for the OS version

**Tasks**

* [`download_file`](#download_file): Download a file to a specified folder
* [`install_pe`](#install_pe): Install PE on a server
* [`pin_node_group`](#pin_node_group): Pin node(s) to a specified node group
* [`run_agent`](#run_agent): Run the Puppet agent until there are no changes

**Plans**

* [`deploy_pe::decom_agent`](#deploy_pedecom_agent): A plan to purge an agent on the master
* [`deploy_pe::provision_agent`](#deploy_peprovision_agent): A plan to install an agent from the master
* [`deploy_pe::provision_compiler`](#deploy_peprovision_compiler): A plan to install an compiler from the master
* [`deploy_pe::provision_master`](#deploy_peprovision_master): A plan to install a new PE master

## Functions

### deploy_pe::master_package_name

Type: Puppet Language

Generate the PE installer package name

#### `deploy_pe::master_package_name(Hash $node_facts, String $version)`

Generate the PE installer package name

Returns: `String` The name of the PE installer package based on the OS and PE version

##### `node_facts`

Data type: `Hash`

A hash of facts that will be used to get the OS version

##### `version`

Data type: `String`

The version of PE

### deploy_pe::platform_tag

Type: Puppet Language

Generate the PE naming for the OS version

#### `deploy_pe::platform_tag(Hash $node_facts, Boolean $underscores = false)`

Generate the PE naming for the OS version

Returns: `String` The name of the OS version in `el-7-x86_64` format

##### `node_facts`

Data type: `Hash`

A hash of facts that will be used to get the OS version

##### `underscores`

Data type: `Boolean`

A boolean to enable to use of underscores instead of dashes for the seperator

## Tasks

### download_file

Download a file to a specified folder

**Supports noop?** false

#### Parameters

##### `url`

Data type: `String[1]`

The HTTP/HTTPS URL for the specified file

### install_pe

Install PE on a server

**Supports noop?** false

#### Parameters

##### `tarball`

Data type: `String[1]`

The path to the PE tarball

##### `pe_conf`

Data type: `String[1]`

The path to the pe.conf

##### `tmpdir`

Data type: `Optional[String[1]]`

The directory to extract the tarball. Defaults to the directory containing the tarball

### pin_node_group

Pin node(s) to a specified node group

**Supports noop?** false

#### Parameters

##### `agent_certnames`

Data type: `Pattern[/^([A-Za-z0-9._-]+,?)+$/]`

A comma-separated list of agent certificate names

##### `node_group`

Data type: `String`

The name of the node group to pin the targets to

### run_agent

Run the Puppet agent until there are no changes

**Supports noop?** false

#### Parameters

##### `retries`

Data type: `Optional[Integer[1]]`

The number of times to retry the agent run before failing. Defaults to 5

##### `wait_time`

Data type: `Optional[Integer[1]]`

The time to wait for a running agent lock to finish. Defaults to 300

## Plans

### deploy_pe::decom_agent

A plan to purge an agent on the master

#### Examples

##### Decommission a node

```puppet
bolt plan run 'deploy_pe::decom_agent' --run-as 'root' --params '{"master":"pe-master"}' --targets 'pe-agent'
```

#### Parameters

The following parameters are available in the `deploy_pe::decom_agent` plan.

##### `master`

Data type: `TargetSpec`

The TargetSpec for the Master to use to run the node purge on

##### `targets`

Data type: `TargetSpec`

The TargetSpec of one or more targets to be removed from the environment

### deploy_pe::provision_agent

A plan to install an agent from the master

#### Examples

##### Install the PE agent on a node

```puppet
bolt plan run 'deploy_pe::provision_agent' --run-as 'root' --params '{"master":"pe-master"}' --targets 'pe-agent'
```

#### Parameters

The following parameters are available in the `deploy_pe::provision_agent` plan.

##### `master`

Data type: `TargetSpec`

The TargetSpec for the Master from which to use the installer script

##### `targets`

Data type: `TargetSpec`

The TargetSpec of one or more targets to be installed

### deploy_pe::provision_compiler

A plan to install an compiler from the master

#### Examples

##### Install the PE agent on a node and configure it as a compiler

```puppet
bolt plan run 'deploy_pe::provision_compiler' --run-as 'root' --params '{"master":"pe-master"}' --targets 'pe-compiler'
```

#### Parameters

The following parameters are available in the `deploy_pe::provision_compiler` plan.

##### `master`

Data type: `TargetSpec`

The TargetSpec for the Master from which to use the installer script

##### `targets`

Data type: `TargetSpec`

The TargetSpec of one or more compilers to be installed

### deploy_pe::provision_master

A plan to install a new PE master

#### Examples

##### Install a 2019.1.1 PE master on a node using `puppetlabs` as the password

```puppet
bolt plan run 'deploy_pe::provision_master' --run-as 'root' --params '{"version":"2019.1.1","pe_settings":{"password":"puppetlabs"}}' --targets 'pe-master'
```

#### Parameters

The following parameters are available in the `deploy_pe::provision_master` plan.

##### `targets`

Data type: `TargetSpec`

The TargetSpec of one or more masters to be installed

##### `version`

Data type: `Optional[String]`

The PE version to download from the $base_url.
The `$version`, `$download_url`, or `$installer_tarball` are mutually exclusive. Please choose only one option.

Default value: `undef`

##### `base_url`

Data type: `Optional[String]`

The base of a HTTP URL that will be used to download the PE installer script.
The resuting format is `${base_url}/${$version}/${package_name}`.

Default value: 'https://pm.puppetlabs.com/puppet-enterprise'

##### `download_url`

Data type: `Optional[String]`

A direct HTTP link to the installer tarball.
The `$version`, `$download_url`, or `$installer_tarball` are mutually exclusive. Please choose only one option.

Default value: `undef`

##### `installer_tarball`

Data type: `Optional[String]`

A path to the installer tarball on the target master. This option assumes that the tarball has already been downloaded on the target machine.
The `$version`, `$download_url`, or `$installer_tarball` are mutually exclusive. Please choose only one option.

Default value: `undef`

##### `pe_settings`

Data type: `Optional[Hash]`

A hash of the settings to be used in the `pe.conf` during the installation.
The most common setting will be the `password`
All other settings can be found in the `templates/pe.conf.epp`

Default value: {password => 'puppetlabs'}

